# InputFile

The `FluentInputFile` wraps the native Blazor `InputFile` component and extends it with drag/drop zone support. See the examples below for some different ways on how to use this component.

**Customization:** You can localize this component by customizing the content of `ChildContent`, but also the content of the progress area via the `ProgressTemplate` attribute. The default progress area displays "Loading", "Completed", or "Canceled" labels via static variables `FluentInputFile.ResourceLoadingXXX`. These can be accessed to globally adapt the default display if you wish.

> **Note:** This component is not yet fully compatible with accessibility.

## Examples

### Default

By default, this component will use the `SaveToTemporaryFolder` mode which creates a local file.

> **Warning:** This might not always be possible depending on the user rights on the host. You may need to change the `InputFileMode` depending on your use case.

<div style="height: 300px; border: 2px dashed var(--neutral-stroke-rest); display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; border-radius: 4px;">
    <svg width="24" height="24" fill="currentColor" style="margin-bottom: 1rem;"><path d="M11 5h2v6h5v2h-5v6h-2v-6H6v-2h5V5Z"/></svg>
    <div>
        Drag files here you wish to upload,
        or <a href="#">browse</a>
        for them<span style="color: red;">*</span>.
        <br>
        <em>Maximum of 4 files allowed.</em>
    </div>
    <div style="margin-top: 1rem;">
        <a href="#">Read more about our supported file formats.</a>
    </div>
</div>

```razor
<FluentInputFile Id="my-file-uploader"
                 Mode="InputFileMode.SaveToTemporaryFolder"
                 Multiple="true"
                 MaximumFileCount="4"
                 MaximumFileSize="@(10*1024*1024)"
                 Accept="image/*"
                 @bind-ProgressPercent="@ProgressPercent"
                 OnCompleted="@OnCompletedAsync"
                 Style="height: 300px;">
    <ChildContent>
        <label for="my-file-uploader">
            <FluentIcon Value="@(new @Icons.Regular.Size24.ArrowUpload())" />
        </label>

        <div>
            Drag files here you wish to upload,
            or <label for="my-file-uploader">browse</label>
            for them<span style="color: red;">*</span>.
            <br />
            <em>Maximum of 4 files allowed.</em>
        </div>

        <div>
            <br />
            <a href="#">Read more about our supported file formats.</a>
        </div>
    </ChildContent>
</FluentInputFile>

@if (Files.Any())
{
    <h4>File(s) uploaded:</h4>
    <ul>
        @foreach (var file in Files)
        {
            <li>
                <b>@file.Name</b> 🔹
                @($"{Decimal.Divide(file.Size, 1024):N} KB") 🔹
                @file.ContentType 🔹
                @file.LocalFile?.FullName
                @file.ErrorMessage
            </li>
        }
    </ul>
}

@code
{
    int ProgressPercent = 0;
    FluentInputFileEventArgs[] Files = Array.Empty<FluentInputFileEventArgs>();

    private async Task OnCompletedAsync(IEnumerable<FluentInputFileEventArgs> files)
    {
        Files = files.ToArray();

        // For the demo, delete these files.
        foreach (var file in Files)
        {
            file.LocalFile?.Delete();
        }

        // Wait 3 seconds before to reset the progress bar.
        await Task.Delay(3000);
        ProgressPercent = 0;
    }
}
```

### Manual upload

<div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
    <div style="width: 100%; height: 4px; background-color: var(--neutral-layer-2); border-radius: 2px; overflow: hidden;">
        <div style="width: 0%; height: 100%; background-color: var(--accent-fill-rest);"></div>
    </div>
    <label></label>
    <button style="padding: 5px 10px; border-radius: 4px; background-color: var(--accent-fill-rest); color: white; border: none;">Upload files</button>
</div>

```razor
<FluentInputFile @ref="@myFileUploader" 
                 DragDropZoneVisible="false"
                 Mode="InputFileMode.SaveToTemporaryFolder"
                 Multiple="true"
                 AnchorId="MyUploadButton"
                 MaximumFileSize="@(100 * 1024 * 1024)"
                 Accept=".mp4, .mov, .avi"
                 OnProgressChange="@(e =>
                     {
                         progressPercent = e.ProgressPercent; 
                         progressTitle = e.ProgressTitle;
                     })"
                 OnCompleted="@OnCompleted" />

<FluentProgress Min="0" Max="100" Visible="@(progressPercent > 0)" Value="@progressPercent" />
<FluentLabel Alignment="HorizontalAlignment.Center">
    @progressTitle
</FluentLabel>

<FluentButton Id="MyUploadButton" Appearance="Appearance.Accent">
    Upload files
</FluentButton>

@if (Files.Any())
{
    <h4>File(s) uploaded:</h4>
    <ul>
        @foreach (var file in Files)
        {
            <li>
                <b>@file.Name</b> 🔹
                @($"{Decimal.Divide(file.Size, 1024):N} KB") 🔹
                @file.ContentType 🔹
                @file.LocalFile?.FullName
                @file.ErrorMessage
            </li>
        }
    </ul>
}

@code
{
    FluentInputFile? myFileUploader = default!;
    int? progressPercent;
    string? progressTitle;

    FluentInputFileEventArgs[] Files = Array.Empty<FluentInputFileEventArgs>();

    void OnCompleted(IEnumerable<FluentInputFileEventArgs> files)
    {
        Files = files.ToArray();
        progressPercent = myFileUploader!.ProgressPercent;
        progressTitle = myFileUploader!.ProgressTitle;

        // For the demo, delete these files.
        foreach (var file in Files)
        {
            file.LocalFile?.Delete();
        }
    }
}
```

### Manual upload with loading indicator

<div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
    <!-- Placeholder for progress and button -->
    <button style="padding: 5px 10px; border-radius: 4px; background-color: var(--accent-fill-rest); color: white; border: none;">Upload files</button>
</div>

```razor
<FluentInputFile @ref="@myFileUploader"
                 DragDropZoneVisible="false"
                 Mode="InputFileMode.SaveToTemporaryFolder"
                 Multiple="true"
                 AnchorId="MyUploadLoadingButton"
                 MaximumFileSize="@(100 * 1024 * 1024)"
                 Accept=".mp4, .mov, .avi"
                 OnProgressChange="@(e =>
                     {
                         _formUploading = true;
                         progressPercent = e.ProgressPercent;
                         progressTitle = e.ProgressTitle;
                     })"
                 OnCompleted="@OnCompleted" />

<FluentProgress Min="0" Max="100" Visible="@(progressPercent > 0)" Value="@progressPercent" />
<FluentLabel Alignment="HorizontalAlignment.Center">
    @progressTitle
</FluentLabel>

<FluentButton Id="MyUploadLoadingButton" Loading="_formUploading" Appearance="Appearance.Accent">
    Upload files
</FluentButton>

@if (Files.Any())
{
    <h4>File(s) uploaded:</h4>
    <ul>
        @foreach (var file in Files)
        {
            <li>
                <b>@file.Name</b> 🔹
                @($"{Decimal.Divide(file.Size, 1024):N} KB") 🔹
                @file.ContentType 🔹
                @file.LocalFile?.FullName
                @file.ErrorMessage
            </li>
        }
    </ul>
}

@code
{
    bool _formUploading;
    FluentInputFile? myFileUploader = default!;
    int? progressPercent;
    string? progressTitle;

    FluentInputFileEventArgs[] Files = Array.Empty<FluentInputFileEventArgs>();

    void OnCompleted(IEnumerable<FluentInputFileEventArgs> files)
    {
        Files = files.ToArray();
        progressPercent = myFileUploader!.ProgressPercent;
        progressTitle = myFileUploader!.ProgressTitle;

        // For the demo, delete these files.
        foreach (var file in Files)
        {
            file.LocalFile?.Delete();
        }
        _formUploading = false;
        StateHasChanged();
    }
}
```

### Mode = `InputFileMode.Buffer`

Using the `Buffer` mode will load the entire file into memory during uploading.

This mode is recommended when you cannot store local files and you are working with small files and have enough memory available.

```razor
<FluentInputFile @ref="@myFileByBuffer"
                 AnchorId="MyUploadBuffer"
                 DragDropZoneVisible="false"
                 Mode="InputFileMode.Buffer"
                 Multiple="true"
                 MaximumFileSize="@(1000 * 1024 * 1024)"
                 Accept=".mp4, .mov, .avi"
                 OnProgressChange="@OnProgressChangeAsync"
                 OnCompleted="@OnCompleted" />

<FluentProgress Visible="@(progressPercent > 0)" Min="0" Max="100" Value="@progressPercent" />
<FluentLabel Alignment="HorizontalAlignment.Center">
    @progressTitle
</FluentLabel>

<FluentButton Appearance="Appearance.Accent" Id="MyUploadBuffer">
    Upload files
</FluentButton>

<FluentButton @onclick="@((e) => IsCanceled = true)">
    Cancel
</FluentButton>

@if (Files.Any())
{
    <h4>File(s) uploaded:</h4>
    <ul>
        @foreach (var file in Files)
        {
            <li>
                @file.Value
            </li>
        }
    </ul>
}

@code
{
    FluentInputFile? myFileByBuffer = default!;
    int? progressPercent;
    string? progressTitle;
    bool IsCanceled;

    Dictionary<int, string> Files = new();

    async Task OnProgressChangeAsync(FluentInputFileEventArgs file)
    {
        progressPercent = file.ProgressPercent;
        progressTitle = file.ProgressTitle;

        // To cancel?
        file.IsCancelled = IsCanceled;

        // New file
        if (!Files.ContainsKey(file.Index))
        {
            var localFile = Path.GetTempFileName() + file.Name;
            Files.Add(file.Index, localFile);
        }

        // Write to the FileStream
        await file.Buffer.AppendToFileAsync(Files[file.Index]);
    }

    void OnCompleted(IEnumerable<FluentInputFileEventArgs> files)
    {
        progressPercent = myFileByBuffer!.ProgressPercent;
        progressTitle = myFileByBuffer!.ProgressTitle;

        // For the demo, delete these files.
        foreach (var file in Files)
        {
            File.Delete(file.Value);
        }
    }
}
```

### Mode = `InputFileMode.Stream`

The `Stream` mode gives you more control of the uploading process to save memory. In order for it to work you will need to implement the handling for the stream on your own.

This mode is recommended when you want to upload large files which you do not want to hold entirely in memory.

> **Warning:** Remember to always dispose each stream to prevent memory leaks!

```razor
<FluentInputFile @ref="@myFileByStream"
                 AnchorId="MyUploadStream"
                 DragDropZoneVisible="false"
                 Mode="InputFileMode.Stream"
                 Multiple="true"
                 MaximumFileSize="@(20 * 1024 * 1024)"
                 Accept=".mp4, .mov, .avi"
                 OnFileUploaded="@OnFileUploadedAsync"
                 OnCompleted="@OnCompleted" />

<FluentProgress Min="0" Max="100" Value="@progressPercent" Visible="@(progressPercent > 0)" />
<FluentLabel Alignment="HorizontalAlignment.Center">
    @progressTitle
</FluentLabel>

<FluentButton Appearance="Appearance.Accent" Id="MyUploadStream">
    Upload files
</FluentButton>

@if (Files.Any())
{
    <h4>File(s) uploaded:</h4>
    <ul>
        @foreach (var file in Files)
        {
            <li>
                @file
            </li>
        }
    </ul>
}

@code
{
    FluentInputFile? myFileByStream = default!;
    int? progressPercent;
    string? progressTitle;

    List<string> Files = new();

    async Task OnFileUploadedAsync(FluentInputFileEventArgs file)
    {
        progressPercent = file.ProgressPercent;
        progressTitle = file.ProgressTitle;

        var localFile = Path.GetTempFileName() + file.Name;
        Files.Add(localFile);

        // Write to the FileStream
        // See other samples: https://docs.microsoft.com/en-us/aspnet/core/blazor/file-uploads
        await using FileStream fs = new(localFile, FileMode.Create);
        await file.Stream!.CopyToAsync(fs);
        await file.Stream!.DisposeAsync();
    }

    void OnCompleted(IEnumerable<FluentInputFileEventArgs> files)
    {
        progressPercent = myFileByStream!.ProgressPercent;
        progressTitle = myFileByStream!.ProgressTitle;

        // For the demo, delete these files.
        foreach (var file in Files)
        {
            File.Delete(file);
        }
    }
}
```

### Disabled Component

<div style="height: 300px; border: 1px dashed var(--neutral-stroke-rest); display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; border-radius: 4px; opacity: var(--disabled-opacity);">
    <svg width="24" height="24" fill="currentColor" style="margin-bottom: 1rem;"><circle cx="12" cy="12" r="10" stroke-width="2" fill="none" stroke="currentColor"/></svg>
    <div>
        This component is disabled. You cannot drag files here,
        or <label>browse</label>
        for them.
    </div>
</div>

```razor
<FluentInputFile Id="my-file-uploader-disabled"
                 Disabled="true"
                 Style="height: 300px; border: 1px dashed var(--accent-fill-rest);">
    <ChildContent>
        <label for="my-file-uploader">
            <FluentIcon Value="@(new @Icons.Regular.Size24.CircleLine())" />
        </label>

        <div>
            This component is disabled. You cannot drag files here,
            or <label for="my-file-uploader-disabled">browse</label>
            for them.
            <br />
        </div>

    </ChildContent>
</FluentInputFile>
```

## Documentation

### FluentInputFile Class

#### Parameters

| Parameter | Type | Default | Description |
| --- | --- | --- | --- |
| **Accept** | `string` | | A filter for file types (e.g., `".gif, .jpg, .png"`, `"image/*"`). |
| **AnchorId** | `string` | | The ID of an element that will trigger the file dialog on click. |
| **BufferSize** | `uint` | `10240` | The buffer size in bytes for reading from the uploaded file (Default: 10 KiB). |
| **ChildContent** | `RenderFragment?` | | The content to be rendered inside the drag-drop zone. |
| **Disabled** | `bool` | `False` | Disables the form control. |
| **DragDropZoneVisible**| `bool` | `True` | Whether the drag-and-drop zone is visible. |
| **MaximumFileCount** | `int` | `10` | The maximum number of files allowed for upload. |
| **MaximumFileSize** | `long` | `10485760`| The maximum size of a single file in bytes (Default: 10 MiB). |
| **Mode** | `InputFileMode` | `SaveToTemporaryFolder` | The file reading mode (`SaveToTemporaryFolder`, `Buffer`, `Stream`). |
| **Multiple** | `bool` | `False` | Whether to allow multiple file selection. |
| **ProgressPercent** | `int` | `0` | The current global progress percentage of the upload. |
| **ProgressTemplate** | `RenderFragment<ProgressFileDetails>?` | | A template for displaying progress information. |
| **ProgressTitle** | `string` | | The current label displayed during an upload. |

#### EventCallbacks

| EventCallback | Type | Description |
| --- | --- | --- |
| **OnCompleted** | `EventCallback<IEnumerable<FluentInputFileEventArgs>>` | Raised when all files have been completely uploaded. |
| **OnFileCountExceeded** | `EventCallback<int>` | Raised when the number of selected files exceeds `MaximumFileCount`. |
| **OnFileError** | `EventCallback<FluentInputFileEventArgs>` | Raised when an error occurs during file upload. |
| **OnFileUploaded** | `EventCallback<FluentInputFileEventArgs>` | Raised when a single file has been completely uploaded. |
| **OnInputFileChange** | `EventCallback<InputFileChangeEventArgs>` | The native event from the underlying `InputFile` component. |
| **OnProgressChange** | `EventCallback<FluentInputFileEventArgs>` | Raised when the upload progress is updated. |
| **ProgressPercentChanged**| `EventCallback<int>` | A callback that updates the bound `ProgressPercent`. |

#### Methods

| Method | Description |
| --- | --- |
| **DisposeAsync()** | Disposes the component. |
| **ShowFilesDialogAsync()** | Programmatically opens the file selection dialog. ⚠️ This method doesn't work on Safari and iOS. |

### Known Issues

Starting with .NET 6, the `InputFile` component does not work in Server-Side Blazor applications using Autofac IoC containers. This issue is being tracked here: [aspnetcore#38842](https://github.com/dotnet/aspnetcore/issues/38842).

Enable `HubOptions.DisableImplicitFromServicesParameters` in `Program.cs` or `Startup.cs` to work around this issue.

```csharp
builder.Services
    .AddServerSideBlazor()
    .AddHubOptions(opt =>
    {
        opt.DisableImplicitFromServicesParameters = true;
    });```